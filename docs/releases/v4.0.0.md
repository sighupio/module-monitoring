# Monitoring Module Release v4.0.0

Welcome to the latest release of the `monitoring` core module of the [`SIGHUP Distribution`](https://github.com/sighupio/fury-distribution), maintained by team SIGHUP by ReeVo.

This major release removes Thanos and Karma packages, updates to `kube-prometheus` v0.16.0 including Prometheus v3 and general bug fixes and new features.

This release also adds support for Kubernetes 1.33.x and 1.34.x.

## Component Images ðŸš¢

| Component             | Supported Version                                                                                          | Previous Version |
| --------------------- | ---------------------------------------------------------------------------------------------------------- | ---------------- |
| `alertmanager`        | [`v0.28.1`](https://github.com/prometheus/alertmanager/releases/tag/v0.28.1)                               | v0.27.0          |
| `blackbox-exporter`   | [`v0.27.0`](https://github.com/prometheus/blackbox_exporter/releases/tag/v0.27.0)                          | v0.25.0          |
| `grafana`             | [`v12.1.0`](https://github.com/grafana/grafana/releases/tag/v12.1.0)                                       | v11.3.0          |
| `kube-rbac-proxy`     | [`v0.19.1`](https://github.com/brancz/kube-rbac-proxy/releases/tag/v0.19.1)                                | v0.18.1          |
| `kube-state-metrics`  | [`v2.16.0`](https://github.com/kubernetes/kube-state-metrics/releases/tag/v2.16.0)                         | v2.13.0          |
| `node-exporter`       | [`v1.9.1`](https://github.com/prometheus/node_exporter/releases/tag/v1.9.1)                                | v1.8.2           |
| `prometheus-adapter`  | [`v0.12.0`](https://github.com/kubernetes-sigs/prometheus-adapter/releases/tag/v0.12.0)                    | No update        |
| `prometheus-operator` | [`v0.85.0`](https://github.com/prometheus-operator/prometheus-operator/releases/tag/v0.85.0)               | v0.76.2          |
| `prometheus-operated` | [`v3.5.0`](https://github.com/prometheus/prometheus/releases/tag/v3.5.0)                                   | v2.54.1          |
| `thanos`              | **REMOVED**                                                                                                | Deprecated       |
| `x509-exporter`       | [`v3.19.1`](https://github.com/enix/x509-certificate-exporter/releases/tag/v3.19.1)                        | v3.18.1          |
| `karma`               | **REMOVED**                                                                                                | v0.113           |
| `mimir`               | [`v2.15.0`](https://github.com/grafana/mimir/releases/tag/mimir-2.15.0)                                    | No update        |
| `minio-ha`            | [`RELEASE.2025-02-28T09-55-16Z`](https://github.com/minio/minio/releases/tag/RELEASE.2025-02-28T09-55-16Z) | No update        |

> Please refer the individual release notes to get a detailed info on the releases.

## Breaking Changes ðŸš¨

### Thanos

Thanos package has been removed. It has been deprecated since v3.3.0, refer to the Mimir package as a replacement.

### Karma

Karma package has been removed from the module. There are no replacements at the moment, please switch to the upstream project if you are using it.

### Prometheus

Prometheus has been upgrade from v2.54.1 to v3.5.0. This major version change includes some breaking changes that are already taken into account by the module. Please read the following documentation to know more on these changes:

https://prometheus.io/blog/2024/11/14/prometheus-3-0/

https://prometheus.io/docs/prometheus/3.0/migration/

For end-users of this module, the following breaking change might be of interest:

#### Scrape protocols

Prometheus v3 is more strict concerning the Content-Type header received when scraping. Prometheus v2 would default to the standard Prometheus text protocol if the target being scraped did not specify a Content-Type header or if the header was unparsable or unrecognised. This could lead to incorrect data being parsed in the scrape. Prometheus v3 will now fail the scrape in such cases.

If a scrape target is not providing the correct Content-Type header the fallback protocol can be specified using the `fallback_scrape_protocol` parameter.

This is a breaking change as scrapes that may have succeeded with Prometheus v2 may now fail if this fallback protocol is not specified.

### Grafana

Grafana has been bumped a major version that includes some breaking changes, specially related to alerting (not in use by this module). You can check them out in the following link:

https://github.com/grafana/grafana/releases/tag/v12.0.0

## New Features ðŸŽ‰

Prometheus v3 comes with some notable new features like (not an exhaustive list):

- New UI
- Remote Write 2.0
- OTLP Support, e.g. now supports OTLP ingestion natively.
- Native Histograms
- Improved performance, ~3.5x better than v2.0

## Update Guide ðŸ¦®

Modules installations and upgrades are now managed by the furyctl tool. Instructions below are left for reference when using the legacy version of furyctl.

### Process

To upgrade this core module from `v3.5.0` to `v4.0.0`, execute the following:

```bash
kustomize build <your-project-path> | kubectl apply -f - --server-side
```
